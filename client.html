<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Client Stream</title>
  <style>body { font-family: sans-serif; text-align: center; }</style>
</head>
<body>
  <h1>ðŸŽ¥ Client Stream</h1>
  <p>Nháº­p chuá»—i káº¿t ná»‘i Ä‘á»ƒ xem stream:</p>
  <textarea id="offerStringInput" rows="4" style="width: 80%; padding: 10px; font-size: 16px;"></textarea>
  <button onclick="connectStream()">Káº¿t ná»‘i vÃ  xem stream</button>
  
  <br><br>
  <video id="video" width="600" controls autoplay></video>

  <script>
    const pc = new RTCPeerConnection();

    // HÃ m káº¿t ná»‘i vÃ  xem stream
    function connectStream() {
      const offerString = document.getElementById('offerStringInput').value;

      if (!offerString) {
        alert("Vui lÃ²ng nháº­p chuá»—i káº¿t ná»‘i!");
        return;
      }

      try {
        // Parse chuá»—i JSON vÃ  thiáº¿t láº­p RemoteDescription
        const offer = JSON.parse(offerString);
        
        // Khi nháº­n track, gÃ¡n stream vÃ o video
        pc.ontrack = (event) => {
          console.log("ÄÃ£ nháº­n track:", event.streams[0]);

          const videoElement = document.getElementById('video');
          // GÃ¡n stream vÃ o video
          videoElement.srcObject = event.streams[0];

          // Kiá»ƒm tra xem video cÃ³ thá»±c sá»± nháº­n Ä‘Æ°á»£c stream khÃ´ng
          if (videoElement.srcObject) {
            console.log("Video Ä‘Ã£ nháº­n stream thÃ nh cÃ´ng.");
          } else {
            console.log("KhÃ´ng thá»ƒ gÃ¡n stream vÃ o video.");
          }

          // Kiá»ƒm tra thÃªm má»™t láº§n ná»¯a náº¿u video chÆ°a hiá»ƒn thá»‹
          if (videoElement.paused) {
            videoElement.play().then(() => {
              console.log("Video báº¯t Ä‘áº§u phÃ¡t!");
            }).catch(error => {
              console.error("Lá»—i khi báº¯t Ä‘áº§u phÃ¡t video:", error);
            });
          }
        };

        // Thiáº¿t láº­p remote description tá»« offer
        pc.setRemoteDescription(offer).then(() => {
          console.log("Káº¿t ná»‘i thÃ nh cÃ´ng vÃ  Ä‘ang stream...");
        }).catch(error => {
          console.error("Lá»—i khi thiáº¿t láº­p remote description:", error);
          alert("Lá»—i khi thiáº¿t láº­p káº¿t ná»‘i: " + error);
        });

        // ThÃªm ICE candidate náº¿u cÃ³
        pc.onicecandidate = (event) => {
          if (event.candidate) {
            console.log("ICE candidate:", event.candidate);
          }
        };

        // Xá»­ lÃ½ tráº¡ng thÃ¡i káº¿t ná»‘i ICE
        pc.oniceconnectionstatechange = () => {
          console.log("ICE connection state change:", pc.iceConnectionState);
        };

      } catch (error) {
        alert("Lá»—i khi káº¿t ná»‘i: " + error);
        console.error("Lá»—i parse chuá»—i:", error);
      }
    }
  </script>
</body>
</html>
