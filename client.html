<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Client Stream</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    video { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ðŸŽ¥ Client Stream</h1>
  <p>Nháº­p chuá»—i káº¿t ná»‘i Ä‘á»ƒ xem stream:</p>
  <textarea id="offerStringInput" rows="4" style="width: 80%; padding: 10px; font-size: 16px;"></textarea>
  <button onclick="connectStream()">Káº¿t ná»‘i vÃ  xem stream</button>
  
  <br><br>
  <video id="video" width="600" controls muted autoplay></video>

  <script>
    const pc = new RTCPeerConnection();
  
    // HÃ m káº¿t ná»‘i vÃ  nháº­n stream
    function connectStream() {
      const offerString = document.getElementById('offerStringInput').value;
  
      if (!offerString) {
        alert("Vui lÃ²ng nháº­p chuá»—i káº¿t ná»‘i!");
        return;
      }
  
      try {
        // Parse chuá»—i JSON vÃ  thiáº¿t láº­p RemoteDescription
        const offer = JSON.parse(offerString);
        
        // Thiáº¿t láº­p remote description tá»« offer
        pc.setRemoteDescription(offer).then(() => {
          console.log("Remote description Ä‘Ã£ Ä‘Æ°á»£c thiáº¿t láº­p.");
          
          // Táº¡o Ä‘Ã¡p á»©ng (answer) cho offer
          return pc.createAnswer();
        }).then(answer => {
          // Gá»­i answer trá»Ÿ láº¡i Ä‘á»ƒ hoÃ n táº¥t káº¿t ná»‘i
          return pc.setLocalDescription(answer);
        }).then(() => {
          console.log("ÄÃ¡p á»©ng (answer) Ä‘Ã£ Ä‘Æ°á»£c gá»­i.");
        }).catch(error => {
          console.error("Lá»—i trong quÃ¡ trÃ¬nh káº¿t ná»‘i:", error);
          alert("Lá»—i káº¿t ná»‘i: " + error);
        });
  
        pc.ontrack = (event) => {
  console.log("ÄÃ£ nháº­n track:", event.streams[0]);
  
  // Kiá»ƒm tra stream nháº­n Ä‘Æ°á»£c
  if (event.streams[0]) {
    const videoElement = document.getElementById('video');
    videoElement.srcObject = event.streams[0]; // GÃ¡n stream vÃ o video
    console.log("Stream Ä‘Ã£ Ä‘Æ°á»£c gÃ¡n vÃ o video element");
  } else {
    console.error("KhÃ´ng nháº­n Ä‘Æ°á»£c stream há»£p lá»‡");
  }
};
        // ThÃªm ICE candidate náº¿u cÃ³
        pc.onicecandidate = (event) => {
          if (event.candidate) {
            console.log("ICE candidate:", event.candidate);
          }
        };
  
        // Kiá»ƒm tra tráº¡ng thÃ¡i káº¿t ná»‘i ICE
        pc.oniceconnectionstatechange = () => {
          console.log("Tráº¡ng thÃ¡i káº¿t ná»‘i ICE thay Ä‘á»•i:", pc.iceConnectionState);
          if (pc.iceConnectionState === 'connected') {
            console.log("Káº¿t ná»‘i ICE Ä‘Ã£ thÃ nh cÃ´ng!");
          }
        };
  
      } catch (error) {
        alert("Lá»—i khi káº¿t ná»‘i: " + error);
        console.error("Lá»—i khi parse chuá»—i:", error);
      }
    }
  </script>
  
</body>
</html>
