<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Host Stream</title>
  <style>body { font-family: sans-serif; text-align: center; }</style>
</head>
<body>
  <h1>üé• Host Stream</h1>
  <p>Qu√©t m√£ QR ho·∫∑c sao ch√©p chu·ªói ƒë·ªÉ k·∫øt n·ªëi:</p>

  <!-- Hi·ªÉn th·ªã QR -->
  <canvas id="qrcode"></canvas>

  <!-- Hi·ªÉn th·ªã chu·ªói localDescription -->
  <input id="offerString" type="text" readonly style="width: 80%; padding: 10px; font-size: 16px;" />

  <button onclick="copyToClipboard()">Sao ch√©p chu·ªói</button>
  <p>Qu√©t m√£ QR ho·∫∑c sao ch√©p chu·ªói ƒë·ªÉ k·∫øt n·ªëi v·ªõi stream c·ªßa b·∫°n.</p>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>

  <script>
    const pc = new RTCPeerConnection();
    let localStream;
  
    // L·∫•y stream m√†n h√¨nh
    navigator.mediaDevices.getDisplayMedia({ video: true }).then(stream => {
      localStream = stream;
      stream.getTracks().forEach(track => pc.addTrack(track, stream));
  
      return pc.createOffer();
    }).then(offer => {
      return pc.setLocalDescription(offer).then(() => offer);
    }).then(offer => {
      // G·ª≠i offer qua URL ho·∫∑c m√£ QR
      const offerString = JSON.stringify(offer);
      const offerId = 'offer_' + Date.now();
      
      localStorage.setItem(offerId, offerString);
      const offerUrl = `client.html?offerId=${offerId}`;
      
      // Hi·ªÉn th·ªã offer URL d∆∞·ªõi d·∫°ng QR code
      QRCode.toCanvas(document.getElementById('qrcode'), offerUrl);
      
      // Hi·ªÉn th·ªã offer string ƒë·ªÉ sao ch√©p
      document.getElementById('offerString').value = offerString;
      
      console.log("Offer ƒë√£ t·∫°o v√† ƒëang ch·ªù k·∫øt n·ªëi...");
    }).catch(error => {
      console.error("L·ªói khi t·∫°o offer:", error);
    });

    // H√†m sao ch√©p chu·ªói v√†o clipboard
    function copyToClipboard() {
      const copyText = document.getElementById('offerString');
      copyText.select();
      copyText.setSelectionRange(0, 99999); // Cho c√°c thi·∫øt b·ªã di ƒë·ªông

      // Sao ch√©p chu·ªói v√†o clipboard
      document.execCommand('copy');
      alert("ƒê√£ sao ch√©p chu·ªói!");
    }
  </script>
  
</body>
</html>
