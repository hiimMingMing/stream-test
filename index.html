<!DOCTYPE html>
<html>
<head>
  <title>Host</title>
</head>
<body>
  <h1>Host</h1>
  <button id="startStream">Bắt đầu stream</button>
  <div id="qrCode"></div> <!-- QR code sẽ được hiển thị ở đây -->

  <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.1/dist/peerjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <script>
    const peer = new Peer();
    const videoElement = document.createElement("video");
    document.body.appendChild(videoElement);

    // Bắt đầu stream
    document.getElementById("startStream").onclick = async function() {
      const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });

      // Khi stream được lấy, thiết lập video
      videoElement.srcObject = stream;
      videoElement.play();

      const offer = await peer.createOffer();
      await peer.setLocalDescription(offer);

      // Tạo offerId và lưu offer vào localStorage của máy tính
      const offerId = 'offer_' + Date.now();
      localStorage.setItem(offerId, JSON.stringify(offer));

      // Tạo URL với offerId
      const offerUrl = `${window.location.href}client.html?offerId=${offerId}`;
      console.log("Offer URL:", offerUrl);

      // Tạo QR code
      QRCode.toCanvas(document.getElementById('qrCode'), offerUrl, function (error) {
        if (error) console.error(error);
      });

      // Lắng nghe kết nối từ peer
      peer.on('call', function(call) {
        call.answer(stream); // Trả lời kết nối với stream của máy tính
      });
    };
  </script>
</body>
</html>
