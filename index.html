<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Host Stream</title>
  <style>body { font-family: sans-serif; text-align: center; }</style>
</head>
<body>
  <h1>üé• Host Stream</h1>
  <p>Qu√©t m√£ QR ho·∫∑c sao ch√©p chu·ªói ƒë·ªÉ k·∫øt n·ªëi:</p>

  <!-- Hi·ªÉn th·ªã QR -->
  <canvas id="qrcode"></canvas>

  <!-- Hi·ªÉn th·ªã chu·ªói localDescription -->
  <input id="offerString" type="text" readonly style="width: 80%; padding: 10px; font-size: 16px;" />

  <button onclick="copyToClipboard()">Sao ch√©p chu·ªói</button>
  <p>Qu√©t m√£ QR ho·∫∑c sao ch√©p chu·ªói ƒë·ªÉ k·∫øt n·ªëi v·ªõi stream c·ªßa b·∫°n.</p>

  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>

  <script>
    const pc = new RTCPeerConnection();
    let localStream;

    // L·∫•y stream m√†n h√¨nh
    navigator.mediaDevices.getDisplayMedia({ video: true }).then(stream => {
      localStream = stream;
      stream.getTracks().forEach(track => pc.addTrack(track, stream));
      return pc.createOffer();
    }).then(offer => {
      return pc.setLocalDescription(offer).then(() => offer);
    }).then(offer => {
      // T·∫°o ID duy nh·∫•t cho offer
      const offerId = 'offer_' + Date.now();
      
      // L∆∞u offer v√†o localStorage
      localStorage.setItem(offerId, JSON.stringify(pc.localDescription));

      // T·∫°o URL ch·ª©a offerId
      const offerUrl = `https://hiimmingming.github.io/stream-test/client?offerId=${offerId}`;
      
      // ƒê·∫∑t offerUrl v√†o QR code
      QRCode.toCanvas(document.getElementById('qrcode'), offerUrl);

      // ƒê·∫∑t chu·ªói localDescription v√†o √¥ nh·∫≠p vƒÉn b·∫£n
      document.getElementById('offerString').value = JSON.stringify(pc.localDescription);
      
      console.log("QR Code v√† chu·ªói localDescription ƒë√£ ƒë∆∞·ª£c t·∫°o. Qu√©t ho·∫∑c sao ch√©p ƒë·ªÉ k·∫øt n·ªëi!");
    });

    // H√†m sao ch√©p chu·ªói v√†o clipboard
    function copyToClipboard() {
      const copyText = document.getElementById('offerString');
      copyText.select();
      copyText.setSelectionRange(0, 99999); // Cho c√°c thi·∫øt b·ªã di ƒë·ªông

      // Sao ch√©p chu·ªói v√†o clipboard
      document.execCommand('copy');
      alert("ƒê√£ sao ch√©p chu·ªói!");
    }
  </script>
</body>
</html>
