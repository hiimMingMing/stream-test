<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Controller</title>
  <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>
  <h1>📲 Xem màn hình máy tính</h1>
  <div id="status">⏳ Đang kết nối...</div>
  <br/>
  <video id="screen" autoplay playsinline style="max-width: 100%; border: 2px solid black;"></video>

  <script>
    const peerId = new URLSearchParams(location.search).get("peerId");

    const peer = new Peer({
      config: {
        iceServers: [
          { urls: "stun:stun.l.google.com:19302" },
          {
            urls: "turn:openrelay.metered.ca:80",
            username: "openrelayproject",
            credential: "openrelayproject"
          },
          {
            urls: "turn:openrelay.metered.ca:443",
            username: "openrelayproject",
            credential: "openrelayproject"
          }
        ]
      }
    });

    peer.on('open', () => {
      const call = peer.call(peerId, null);
      call.on('stream', stream => {
        const video = document.getElementById('screen');
        video.srcObject = stream;
        document.getElementById('status').innerText = "📺 Đang xem màn hình từ máy tính!";
      });

      call.on('error', err => {
        console.error("Call error:", err);
        document.getElementById('status').innerText = "❌ Lỗi khi nhận stream!";
      });
    });
  </script>
</body>
</html>
